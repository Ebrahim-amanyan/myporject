<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ Ø³ÛŒÙ†Ù…Ø§ÛŒ Ø¯ÙˆÙ†ÙØ±Ù‡ - Ù†Ø³Ø®Ù‡ ØªØ¶Ù…ÛŒÙ†ÛŒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma; }
        body { background: linear-gradient(135deg, #0c2461, #1e3799); color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; padding: 20px 0; }
        h1 { color: #00d4ff; font-size: 2.2rem; margin-bottom: 10px; }
        
        /* Status Box */
        .status-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; }
        #status { font-weight: bold; padding: 10px; border-radius: 5px; }
        .status-online { background: rgba(0,255,0,0.2); color: #0f0; }
        .status-offline { background: rgba(255,0,0,0.2); color: #f00; }
        
        /* Controls */
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 15px 0; }
        button { padding: 12px 20px; border: none; border-radius: 5px; background: #00a8ff; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #0097e6; }
        button:disabled { background: #555; cursor: not-allowed; }
        input { padding: 12px; border: none; border-radius: 5px; background: rgba(255,255,255,0.1); color: white; width: 250px; }
        
        /* Video */
        .video-container { margin: 20px 0; }
        #videoPlayer { width: 100%; max-width: 800px; height: 400px; background: #000; border-radius: 5px; display: block; margin: 0 auto; }
        
        /* Chat */
        .chat-container { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin: 20px 0; }
        .chat-messages { height: 200px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; margin-bottom: 10px; }
        .message { padding: 8px 12px; margin: 5px 0; background: rgba(0,212,255,0.1); border-radius: 5px; }
        .message-self { background: rgba(0,255,0,0.1); text-align: left; }
        
        /* Room Info */
        .room-info { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px; margin: 10px 0; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¬ Ø³ÛŒÙ†Ù…Ø§ÛŒ Ø¯ÙˆÙ†ÙØ±Ù‡ - Ù†Ø³Ø®Ù‡ ØªØ¶Ù…ÛŒÙ†ÛŒ</h1>
            <p>Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ - Ú©Ø§Ø± Ø¯Ø± Ù‡Ø± Ù…Ø±ÙˆØ±Ú¯Ø±ÛŒ</p>
        </header>
        
        <!-- Status -->
        <div class="status-box">
            <div id="status" class="status-offline">ğŸ”´ Ø¢Ù…Ø§Ø¯Ù‡ Ø§ØªØµØ§Ù„</div>
            <div class="room-info">
                Ø´Ù†Ø§Ø³Ù‡ Ø´Ù…Ø§: <span id="myId">---</span> | 
                Ø§ÙØ±Ø§Ø¯ Ù…ØªØµÙ„: <span id="userCount">0</span>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <button onclick="createRoom()" id="createBtn">ğŸ  Ø³Ø§Ø®Øª Ø§ØªØ§Ù‚</button>
            <button onclick="joinRoom()" id="joinBtn">ğŸ”— Ù¾ÛŒÙˆØ³ØªÙ†</button>
            <input type="text" id="roomIdInput" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø§ØªØ§Ù‚">
            <button onclick="copyLink()" id="copyBtn">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
        </div>
        
        <!-- Video -->
        <div class="video-container">
            <video id="videoPlayer" controls></video>
            <div class="controls" style="margin-top: 10px;">
                <input type="text" id="videoUrl" placeholder="Ù„ÛŒÙ†Ú© MP4 ÛŒØ§ YouTube">
                <button onclick="loadVideo()">â–¶ï¸ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆÛŒØ¯ÛŒÙˆ</button>
            </div>
        </div>
        
        <!-- Chat -->
        <div class="chat-container">
            <h3>ğŸ’¬ Ú†Øª ÙØ§Ø±Ø³ÛŒ</h3>
            <div class="chat-messages" id="chatMessages">
                <div class="message">Ø¨Ù‡ Ø³ÛŒÙ†Ù…Ø§ÛŒ Ø¯ÙˆÙ†ÙØ±Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</div>
            </div>
            <div class="controls">
                <input type="text" id="messageInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." style="flex:1;">
                <button onclick="sendMessage()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„</button>
            </div>
        </div>
        
        <!-- Instructions -->
        <div style="background: rgba(255,255,0,0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
            <h3>ğŸ“‹ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:</h3>
            <p>Û±. Ø±ÙˆÛŒ "Ø³Ø§Ø®Øª Ø§ØªØ§Ù‚" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
            <p>Û². Ø´Ù†Ø§Ø³Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³Øª Ø®ÙˆØ¯ Ø¨ÙØ±Ø³ØªÛŒØ¯</p>
            <p>Û³. Ø¯ÙˆØ³ØªØªØ§Ù† Ø±ÙˆÛŒ "Ù¾ÛŒÙˆØ³ØªÙ†" Ú©Ù„ÛŒÚ© Ú©Ù†Ø¯ Ùˆ Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†Ø¯</p>
            <p>Û´. Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆÛŒØ¯ÛŒÙˆ ØªÙ…Ø§Ø´Ø§ Ú©Ù†ÛŒØ¯ Ùˆ Ú†Øª Ú©Ù†ÛŒØ¯!</p>
        </div>
    </div>

    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ====================
        let currentRoom = null;
        let myId = null;
        let connectedUsers = new Set();
        let messageQueue = [];
        let isHost = false;
        
        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø§ØªØ§Ù‚ ====================
        
        function createRoom() {
            if (currentRoom) return;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø´Ù†Ø§Ø³Ù‡ ØªØµØ§Ø¯ÙÛŒ
            myId = generateId();
            currentRoom = generateRoomId();
            isHost = true;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('movieRoomId', currentRoom);
            localStorage.setItem('movieUserId', myId);
            localStorage.setItem('movieIsHost', 'true');
            
            // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateStatus(`âœ… Ø§ØªØ§Ù‚ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯! Ø´Ù†Ø§Ø³Ù‡: ${currentRoom}`, 'online');
            document.getElementById('myId').textContent = myId;
            document.getElementById('createBtn').disabled = true;
            document.getElementById('joinBtn').disabled = true;
            
            // Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            startSync();
            
            addMessage('Ø³ÛŒØ³ØªÙ…', `Ø§ØªØ§Ù‚ "${currentRoom}" Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯. Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³Øª Ø®ÙˆØ¯ Ø¨ÙØ±Ø³ØªÛŒØ¯:`);
            addMessage('Ø³ÛŒØ³ØªÙ…', window.location.href + '?room=' + currentRoom);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯ Ø¨Ù‡ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
            connectedUsers.add(myId);
            updateUserCount();
        }
        
        function joinRoom() {
            const roomId = document.getElementById('roomIdInput').value.trim();
            if (!roomId) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ Ø§ØªØ§Ù‚ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }
            
            if (currentRoom) return;
            
            myId = generateId();
            currentRoom = roomId;
            isHost = false;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('movieRoomId', currentRoom);
            localStorage.setItem('movieUserId', myId);
            localStorage.setItem('movieIsHost', 'false');
            
            // Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateStatus(`âœ… Ù…ØªØµÙ„ Ø¨Ù‡ Ø§ØªØ§Ù‚: ${currentRoom}`, 'online');
            document.getElementById('myId').textContent = myId;
            document.getElementById('createBtn').disabled = true;
            document.getElementById('joinBtn').disabled = true;
            
            // Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            startSync();
            
            addMessage('Ø³ÛŒØ³ØªÙ…', `Ø¨Ù‡ Ø§ØªØ§Ù‚ "${currentRoom}" Ù¾ÛŒÙˆØ³ØªÛŒØ¯.`);
            addMessage('Ø³ÛŒØ³ØªÙ…', 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯...');
            
            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø§Ø² Ù…ÛŒØ²Ø¨Ø§Ù†
            sendData({
                type: 'requestSync',
                from: myId
            });
            
            connectedUsers.add(myId);
            updateUserCount();
        }
        
        function copyLink() {
            if (!currentRoom) {
                alert('Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø§ØªØ§Ù‚ Ø¨Ø³Ø§Ø²ÛŒØ¯ ÛŒØ§ Ø¨Ù‡ Ø¢Ù† Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯!');
                return;
            }
            
            const link = window.location.href + '?room=' + currentRoom;
            navigator.clipboard.writeText(link).then(() => {
                alert(`Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯:\n${link}`);
            });
        }
        
        // ==================== Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ====================
        
        function startSync() {
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ localStorage
            setInterval(() => {
                syncWithStorage();
            }, 1000); // Ù‡Ø± 1 Ø«Ø§Ù†ÛŒÙ‡ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± localStorage
            window.addEventListener('storage', (e) => {
                if (e.key === `movieRoom_${currentRoom}`) {
                    try {
                        const data = JSON.parse(e.newValue);
                        if (data && data.user !== myId) {
                            processIncomingData(data);
                        }
                    } catch (err) {
                        console.log('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡:', err);
                    }
                }
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ URL
            checkUrlParams();
        }
        
        function syncWithStorage() {
            if (!currentRoom) return;
            
            // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø± ØµÙ Ø§Ù†ØªØ¸Ø§Ø±
            while (messageQueue.length > 0) {
                const message = messageQueue.shift();
                sendData(message);
            }
            
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆÛŒØ¯ÛŒÙˆ
            syncVideoStatus();
        }
        
        function sendData(data) {
            if (!currentRoom) return;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ø³ØªÙ†Ø¯Ù‡
            data.user = myId;
            data.timestamp = Date.now();
            data.room = currentRoom;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage (Ø¨Ø±Ø§ÛŒ Ø¯ÛŒÚ¯Ø±Ø§Ù†)
            localStorage.setItem(`movieRoom_${currentRoom}`, JSON.stringify(data));
            
            // Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Ù…Ø§Ù† Ù‡Ù… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†ÛŒÙ…
            setTimeout(() => {
                processIncomingData(data);
            }, 100);
        }
        
        function processIncomingData(data) {
            if (!data || data.user === myId) return;
            
            switch (data.type) {
                case 'chat':
                    addMessage('Ø¯ÙˆØ³Øª', data.text);
                    break;
                    
                case 'videoChange':
                    if (data.url) {
                        const video = document.getElementById('videoPlayer');
                        if (video.src !== data.url) {
                            video.src = data.url;
                            video.load();
                            addMessage('Ø³ÛŒØ³ØªÙ…', 'Ø¯ÙˆØ³ØªØ§Ù† ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯.');
                        }
                    }
                    break;
                    
                case 'videoControl':
                    const video = document.getElementById('videoPlayer');
                    if (data.action === 'play' && video.paused) {
                        video.play();
                    } else if (data.action === 'pause' && !video.paused) {
                        video.pause();
                    } else if (data.action === 'seek') {
                        video.currentTime = data.time;
                    }
                    break;
                    
                case 'requestSync':
                    if (isHost) {
                        // Ù…ÛŒØ²Ø¨Ø§Ù† ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                        const video = document.getElementById('videoPlayer');
                        sendData({
                            type: 'videoSync',
                            url: video.src,
                            time: video.currentTime,
                            playing: !video.paused
                        });
                    }
                    break;
                    
                case 'videoSync':
                    if (data.url) {
                        const video = document.getElementById('videoPlayer');
                        video.src = data.url;
                        video.load();
                        video.currentTime = data.time || 0;
                        
                        if (data.playing) {
                            setTimeout(() => video.play(), 500);
                        }
                        
                        addMessage('Ø³ÛŒØ³ØªÙ…', 'ÙˆÛŒØ¯ÛŒÙˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯.');
                    }
                    break;
                    
                case 'userJoin':
                    if (!connectedUsers.has(data.userId)) {
                        connectedUsers.add(data.userId);
                        updateUserCount();
                        addMessage('Ø³ÛŒØ³ØªÙ…', 'Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒÙˆØ³Øª.');
                    }
                    break;
            }
        }
        
        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒØ¯ÛŒÙˆ ====================
        
        function loadVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            if (!url) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }
            
            const video = document.getElementById('videoPlayer');
            video.src = url;
            video.load();
            
            addMessage('Ø³ÛŒØ³ØªÙ…', `ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯: ${url.substring(0, 50)}...`);
            
            // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù†
            sendData({
                type: 'videoChange',
                url: url
            });
        }
        
        function syncVideoStatus() {
            const video = document.getElementById('videoPlayer');
            
            // Ø§Ú¯Ø± Ù…ÛŒØ²Ø¨Ø§Ù† Ù‡Ø³ØªÛŒÙ…ØŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
            if (isHost && video.src && currentRoom) {
                // Ø§ÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± syncWithStorage Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            }
            
            // Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆ
            video.addEventListener('play', () => {
                sendData({
                    type: 'videoControl',
                    action: 'play',
                    time: video.currentTime
                });
            });
            
            video.addEventListener('pause', () => {
                sendData({
                    type: 'videoControl',
                    action: 'pause',
                    time: video.currentTime
                });
            });
            
            video.addEventListener('seeked', () => {
                sendData({
                    type: 'videoControl',
                    action: 'seek',
                    time: video.currentTime
                });
            });
        }
        
        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª ====================
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            if (!currentRoom) {
                alert('Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ ÛŒÚ© Ø§ØªØ§Ù‚ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯!');
                return;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯Ù…Ø§Ù†
            addMessage('Ø´Ù…Ø§', text);
            
            // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù†
            sendData({
                type: 'chat',
                text: text
            });
            
            input.value = '';
        }
        
        // ==================== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ ====================
        
        function generateId() {
            return Math.random().toString(36).substring(2, 8) + 
                   Math.random().toString(36).substring(2, 8);
        }
        
        function generateRoomId() {
            return Math.random().toString(36).substring(2, 10).toUpperCase();
        }
        
        function updateStatus(text, className) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = className === 'online' ? 'status-online' : 'status-offline';
        }
        
        function updateUserCount() {
            document.getElementById('userCount').textContent = connectedUsers.size;
        }
        
        function addMessage(sender, text) {
            const chat = document.getElementById('chatMessages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender === 'Ø´Ù…Ø§' ? 'message-self' : ''}`;
            msgDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
            chat.appendChild(msgDiv);
            chat.scrollTop = chat.scrollHeight;
        }
        
        function checkUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const roomId = params.get('room');
            
            if (roomId && !currentRoom) {
                document.getElementById('roomIdInput').value = roomId;
                setTimeout(() => {
                    if (confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø§ØªØ§Ù‚ "${roomId}" Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯ØŸ`)) {
                        joinRoom();
                    }
                }, 500);
            }
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        
        function initialize() {
            // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§ØªØ§Ù‚ Ù‚Ø¨Ù„ÛŒ
            const savedRoom = localStorage.getItem('movieRoomId');
            const savedUserId = localStorage.getItem('movieUserId');
            
            if (savedRoom && savedUserId) {
                if (confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø§ØªØ§Ù‚ Ù‚Ø¨Ù„ÛŒ "${savedRoom}" Ø¨Ø±Ú¯Ø±Ø¯ÛŒØ¯ØŸ`)) {
                    myId = savedUserId;
                    currentRoom = savedRoom;
                    isHost = localStorage.getItem('movieIsHost') === 'true';
                    
                    updateStatus(`âœ… Ø§ØªØ§Ù‚ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯: ${currentRoom}`, 'online');
                    document.getElementById('myId').textContent = myId;
                    document.getElementById('createBtn').disabled = true;
                    document.getElementById('joinBtn').disabled = true;
                    
                    startSync();
                    addMessage('Ø³ÛŒØ³ØªÙ…', `Ø§ØªØ§Ù‚ "${currentRoom}" Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯.`);
                }
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Enter Ø¨Ø±Ø§ÛŒ Ú†Øª
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            addMessage('Ø³ÛŒØ³ØªÙ…', 'Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ ÛŒÚ© Ø§ØªØ§Ù‚ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯ ÛŒØ§ Ø¨Ù‡ Ø§ØªØ§Ù‚ÛŒ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯.');
        }
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        window.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
